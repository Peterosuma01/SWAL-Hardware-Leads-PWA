<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Lead Generation Follow-up System for Steelwool Africa LTD">
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Steelwool Leads">
  
  <title>Steelwool Africa LTD - Lead Generation</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-192x192.png">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; padding:20px; display:flex; justify-content:center; align-items:center; }
    .container { background:white; border-radius:12px; box-shadow:0 20px 60px rgba(0,0,0,0.3); max-width:760px; width:100%; padding:28px; }
    .header { text-align:center; margin-bottom:18px; padding-bottom:12px; border-bottom:3px solid #667eea; }
    h1 { color:#333; font-size:22px; margin-bottom:4px; }
    .subtitle { color:#666; font-size:14px; }
    .form-group { margin-bottom:14px; }
    label { display:block; margin-bottom:8px; color:#333; font-weight:600; font-size:13px; }
    input[type="text"], input[type="password"], input[type="email"], select { width:100%; padding:10px 12px; border:2px solid #e1e8ed; border-radius:8px; font-size:13px; transition:all 0.3s ease; background:white; }
    select { cursor:pointer; appearance:none; padding-right:40px; }
    .section-title { color:#667eea; font-size:16px; font-weight:700; margin-top:18px; margin-bottom:10px; padding-bottom:6px; border-bottom:2px solid #f0f0f0; }
    .btn { width:100%; padding:12px; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; border:none; border-radius:8px; font-size:15px; font-weight:600; cursor:pointer; transition:all 0.3s ease; margin-top:8px; }
    .btn.small { width:48%; padding:10px; font-size:13px; }
    .btn-row { display:flex; gap:8px; }
    .message { padding:12px; border-radius:8px; margin-top:14px; display:none; font-size:13px; }
    .message.success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
    .message.error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }
    .message.info { background:#d1ecf1; color:#0c5460; border:1px solid #bee5eb; }
    .message.show { display:block; animation: slideIn 0.3s ease; }
    .loading { display:none; text-align:center; color:#667eea; font-size:13px; margin-top:8px; }
    .loading.show { display:block; }
    @keyframes slideIn { from { opacity:0; transform:translateY(-10px);} to { opacity:1; transform:translateY(0);} }
    .meta { font-size:12px; color:#666; margin-top:6px; }
    .details-table { width:100%; border-collapse:collapse; margin-top:12px; border-radius:8px; overflow:hidden; box-shadow:0 6px 20px rgba(0,0,0,0.06); }
    .details-table th, .details-table td { padding:10px 12px; border-bottom:1px solid #f0f0f0; text-align:left; font-size:13px; }
    .details-table th { background:#fafafa; font-weight:700; color:#333; }
    .small-muted { font-size:12px; color:#666; margin-top:6px; }
    .hidden { display:none; }
    .field-inline { display:flex; gap:8px; align-items:center; }
    .field-inline > * { flex:1; }
    .leads-list-section { margin-top:20px; }
    .leads-table { width:100%; border-collapse:collapse; margin-top:12px; font-size:12px; max-height:400px; overflow-y:auto; display:block; }
    .leads-table thead { position:sticky; top:0; background:#fafafa; z-index:1; }
    .leads-table th, .leads-table td { padding:8px; border:1px solid #e1e8ed; text-align:left; }
    .leads-table th { font-weight:700; color:#333; }
    .leads-table tbody { display:block; max-height:300px; overflow-y:auto; }
    .leads-table thead, .leads-table tbody tr { display:table; width:100%; table-layout:fixed; }
    .btn-list { background: linear-gradient(135deg,#3b82f6 0%,#2563eb 100%); margin-top:12px; }
    .config-section { background:#fff3cd; border:1px solid #ffc107; padding:12px; border-radius:8px; margin-bottom:18px; }
    .config-section strong { color:#856404; }
    .config-input { width:100%; padding:8px; margin-top:8px; border:1px solid #ffc107; border-radius:6px; font-size:12px; font-family:monospace; }
    @media (max-width:640px) {
      .btn-row { flex-direction:column; }
      .btn.small { width:100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Steelwool Africa LTD</h1>
      <p class="subtitle">Lead Generation Follow-up</p>
      <p id="loggedInAs" class="meta"></p>
      <p id="installPrompt" class="meta" style="display:none; color:#667eea; margin-top:8px;">
        üì± <span id="installText">Install this app for easy access</span>
      </p>
    </div>

    <!-- Configuration Section -->
    <div class="config-section">
      <strong>‚öôÔ∏è Configuration Required</strong>
      <p style="font-size:12px; margin-top:4px; color:#856404;">
        Enter your Google Apps Script Web App URL below:
      </p>
      <input 
        type="text" 
        id="scriptUrlInput" 
        class="config-input" 
        placeholder="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec"
      >
      <button id="saveConfigBtn" class="btn" style="margin-top:8px; background:#ffc107; color:#333;">Save Configuration</button>
      <div id="configMessage" class="message"></div>
    </div>

    <form id="leadForm">
      <div class="form-group">
        <label for="roleSelect">Select Role *</label>
        <select id="roleSelect" required>
          <option value="">-- Select Role --</option>
          <option value="Supervisor">Supervisor</option>
          <option value="SalesRep">Sales Representative</option>
        </select>
        <div class="meta">Choose <strong>Supervisor</strong> to edit Qualification and Approve/Decline (password required). Choose <strong>Sales Representative</strong> to edit Presentation (email, password, and approval required).</div>
      </div>

      <!-- Sales Rep Authentication -->
      <div id="salesRepAuthSection" class="hidden">
        <div class="form-group">
          <label for="salesRepEmailAuth">Sales Rep Email (from Column B) *</label>
          <input type="email" id="salesRepEmailAuth" placeholder="salesrep@example.com" required>
          <div class="small-muted">Enter your email address as stored in the sheet (Column B).</div>
        </div>
        <div class="form-group">
          <label for="salesRepPasswordAuth">Sales Rep Password *</label>
          <input type="password" id="salesRepPasswordAuth" placeholder="Enter your password" required>
        </div>
      </div>

      <!-- View Leads Buttons -->
      <div id="viewLeadsButtons" class="hidden">
        <button type="button" id="viewGeneratedLeadsBtn" class="btn btn-list hidden">View Generated Leads</button>
        <button type="button" id="viewQualifiedLeadsBtn" class="btn btn-list hidden">View Qualified Leads</button>
      </div>

      <div class="form-group">
        <label for="customerCode">Customer Code *</label>
        <div class="field-inline">
          <input type="text" id="customerCode" name="customerCode" required placeholder="Enter customer code">
          <button type="button" id="loadBtn" class="btn small" style="width:auto;padding:10px 14px;">Load</button>
        </div>
        <div style="margin-top:8px;font-size:12px;color:#666;">Enter a code and click <strong>Load</strong> to fetch existing data.</div>
      </div>

      <!-- Leads List Section -->
      <div id="leadsListSection" class="leads-list-section hidden">
        <div class="section-title" id="leadsListTitle">Leads</div>
        <div style="overflow-x:auto;">
          <table class="leads-table" id="leadsTable">
            <thead>
              <tr>
                <th>Region</th>
                <th>Area</th>
                <th>Location</th>
                <th>Store Name</th>
                <th>Contact Person</th>
                <th>Mobile Number</th>
                <th>Outlet Category</th>
                <th>Brands Stocked</th>
                <th>Purchase Frequency</th>
                <th>Main Supplier</th>
                <th>Distributor Type</th>
                <th>Weldplus Awareness</th>
                <th>Additional Feedback</th>
                <th>Customer Code</th>
              </tr>
            </thead>
            <tbody id="leadsTableBody">
            </tbody>
          </table>
        </div>
        <button type="button" id="closeLeadsListBtn" class="btn small" style="background:#9ca3af;margin-top:12px;">Close List</button>
      </div>

      <!-- Customer Details Section -->
      <div id="detailsSection" class="hidden">
        <div class="section-title">Customer Details</div>
        <div style="overflow-x:auto;">
          <table class="details-table" id="detailsTable">
            <thead>
              <tr>
                <th>Region (C)</th>
                <th>Area (D)</th>
                <th>Location (E)</th>
                <th>Store Name (F)</th>
                <th>Contact Person (G)</th>
                <th>Mobile Number (H)</th>
                <th>Outlet Category (I)</th>
                <th>Brands Stocked (J)</th>
                <th>Purchase Frequency (K)</th>
                <th>Main Supplier (L)</th>
                <th>Distributor Type (M)</th>
                <th>Weldplus Awareness (N)</th>
                <th>Additional Feedback (O)</th>
                <th>Customer Code (P)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td id="d_region"></td>
                <td id="d_area"></td>
                <td id="d_location"></td>
                <td id="d_storeName"></td>
                <td id="d_contactPerson"></td>
                <td id="d_mobileNumber"></td>
                <td id="d_outletCategory"></td>
                <td id="d_brandsStocked"></td>
                <td id="d_purchaseFrequency"></td>
                <td id="d_mainSupplier"></td>
                <td id="d_distributorType"></td>
                <td id="d_weldplusAwareness"></td>
                <td id="d_additionalFeedback"></td>
                <td id="d_customerCode"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="section-title">Qualification</div>
      <div class="form-group">
        <label for="qualification">Qualification Status *</label>
        <select id="qualification" name="qualification" required>
          <option value="">-- Select Status --</option>
          <option value="YES">YES</option>
          <option value="NO">NO</option>
          <option value="Volume Too Small">Volume Too Small</option>
          <option value="Bad Previous History">Bad Previous History</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <div class="btn-row" style="margin-bottom:14px;">
        <button type="button" id="approveBtn" class="btn small" style="background:linear-gradient(135deg,#22c55e 0%,#16a34a 100%); display:none;">Approve</button>
        <button type="button" id="declineBtn" class="btn small" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%); display:none;">Decline</button>
      </div>

      <div class="section-title">Presentation</div>
      <div class="form-group">
        <label for="presentation">Presentation Status *</label>
        <select id="presentation" name="presentation" required>
          <option value="">-- Select Status --</option>
          <option value="YES">YES</option>
          <option value="Refused to Trade">Refused to Trade</option>
          <option value="Refuse to Provide KYC">Refuse to Provide KYC</option>
          <option value="Other">Other</option>
        </select>
      </div>

      <!-- Sales Rep Email Container -->
      <div id="salesRepEmailContainer" class="form-group hidden">
        <label for="salesRepEmail">Sales Rep Email (saved to sheet column B)</label>
        <input type="email" id="salesRepEmail" placeholder="salesrep@example.com" />
        <div class="small-muted">Optional: enter the sales rep's email and click Approve / Decline or Submit to save it.</div>
      </div>

      <button type="submit" class="btn" id="submitBtn">Submit</button>

      <div class="loading" id="loading">Processing...</div>
      <div class="message" id="message"></div>
    </form>
  </div>

  <!-- Password Modal -->
  <div id="passwordModal" style="display:none;">
    <div class="modal-overlay" id="modalOverlay" style="position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:1000;">
      <div class="modal" role="dialog" aria-modal="true" style="background:white;padding:18px;border-radius:8px;width:320px;box-shadow:0 10px 30px rgba(0,0,0,0.3);">
        <h3 style="margin-bottom:10px;font-size:16px;color:#333;">Supervisor Password</h3>
        <div class="row" style="margin-bottom:10px;">
          <input type="password" id="supervisorPasswordInput" placeholder="Enter supervisor password" style="width:100%;padding:10px;border:1px solid #e1e8ed;border-radius:6px;">
        </div>
        <div class="actions" style="display:flex;gap:8px;justify-content:flex-end;">
          <button id="cancelPasswordBtn" class="btn small" style="background:#9ca3af;color:#fff;">Cancel</button>
          <button id="submitPasswordBtn" class="btn small">Submit</button>
        </div>
        <p id="passwordHint" style="font-size:12px;color:#666;margin-top:8px;display:none;"></p>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    // PWA Installation
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('Service Worker registered'))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }

    // Install prompt
    let deferredPrompt;
    const installPrompt = document.getElementById('installPrompt');
    const installText = document.getElementById('installText');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installPrompt.style.display = 'block';
    });

    installPrompt.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          installText.textContent = 'App installed successfully!';
          setTimeout(() => {
            installPrompt.style.display = 'none';
          }, 2000);
        }
        deferredPrompt = null;
      }
    });

    window.addEventListener('appinstalled', () => {
      console.log('PWA installed');
      installPrompt.style.display = 'none';
    });
  </script>
</body>
</html>
